document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(e){e.target.classList.contains("toggle-module")&&(e.preventDefault(),c(e.target))});function c(e){const a=e.dataset.module,s=e.dataset.action,t=e.closest(".akyos-module-card");e.disabled=!0,e.textContent="Chargement...",fetch(akyosModules.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"akyos_toggle_module",module:a,toggle_action:s,nonce:akyosModules.nonce})}).then(o=>o.json()).then(o=>{o.success?(r(t,s==="activate"),n("Module "+(s==="activate"?"activé":"désactivé")+" avec succès !","success")):n("Erreur: "+(o.data||"Erreur inconnue"),"error")}).catch(o=>{console.error("Erreur:",o),n("Erreur de connexion. Veuillez réessayer.","error")}).finally(()=>{e.disabled=!1})}function r(e,a){const s=e.querySelector(".toggle-module"),t=e.querySelector(".status-indicator"),o=e.querySelector(".status-text");a?(e.classList.remove("inactive"),e.classList.add("active"),t.classList.remove("inactive"),t.classList.add("active"),o.textContent="Actif",s.classList.remove("button-primary"),s.classList.add("button-secondary"),s.textContent="Désactiver",s.dataset.action="deactivate"):(e.classList.remove("active"),e.classList.add("inactive"),t.classList.remove("active"),t.classList.add("inactive"),o.textContent="Inactif",s.classList.remove("button-secondary"),s.classList.add("button-primary"),s.textContent="Activer",s.dataset.action="activate"),e.classList.add("updating"),setTimeout(()=>{e.classList.remove("updating")},300)}function n(e,a){const s=a==="success"?"notice-success":"notice-error",t=document.createElement("div");t.className=`notice ${s} is-dismissible`,t.innerHTML=`<p>${e}</p>`;const o=document.querySelector(".wrap h1");o&&o.parentNode&&o.parentNode.insertBefore(t,o.nextSibling),setTimeout(()=>{t.style.opacity="0",t.style.transition="opacity 0.3s ease",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)},5e3),t.addEventListener("click",function(l){l.target.classList.contains("notice-dismiss")&&(t.style.opacity="0",t.style.transition="opacity 0.3s ease",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300))})}const i=document.querySelectorAll(".akyos-module-card");i.forEach((e,a)=>{e.style.animationDelay=a*.1+"s"}),i.forEach(e=>{e.addEventListener("mouseenter",function(){const a=this.querySelector(".module-actions .button");a&&a.classList.add("hover")}),e.addEventListener("mouseleave",function(){const a=this.querySelector(".module-actions .button");a&&a.classList.remove("hover")})})});
